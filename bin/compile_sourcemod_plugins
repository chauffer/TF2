#!/bin/bash
set -ex
TMPDIR="/tmp/compile_sourcemod_plugins"
FROM="/home/steam/sourcemod_plugins/"
SMDIR="/home/steam/tf2/tf/addons/sourcemod/"

mkdir -p $TMPDIR/include
cd $TMPDIR

cp -r $SMDIR/scripting/include $TMPDIR/include
cp -r $FROM/* $TMPDIR
rm -f *.smx

for i in $(ls | grep \.sp$); do
    smxfile="`echo $i | sed -e 's/\.sp$/\.smx/'`"
    ${SMDIR}/scripting/spcomp64 $i -o $smxfile || true
done

cp *.smx ${SMDIR}/plugins/ || true
rm -rf $TMPDIR
